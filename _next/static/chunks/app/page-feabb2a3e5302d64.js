(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7099:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var a=n(8260),l=n(7688);function r(e){let{onChange:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-2",children:"候選名單（每行一位）："}),(0,a.jsx)("textarea",{rows:8,onChange:e=>{t(e.target.value.split("\n").map(e=>e.trim()).filter(e=>""!==e))},placeholder:"小明\n小美\n小華",className:"w-full p-2 border rounded"})]})}function s(e){let{prizes:t,setPrizes:n,drawResult:r}=e,[s,i]=(0,l.useState)(!1),[d,o]=(0,l.useState)(""),c=(e,a,l)=>{let r=[...t];"count"===a?r[e][a]=Math.max(1,parseInt(l)||1):r[e][a]=l,n(r)};return(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"獎品清單"}),(0,a.jsx)("button",{onClick:()=>{s||o(t.map(e=>"".concat(e.name,",").concat(e.count)).join("\n")),i(!s)},className:"text-blue-600 hover:underline",children:s?"切換到表單模式":"切換到 CSV 模式"})]}),s?(0,a.jsx)("textarea",{rows:8,value:d,onChange:e=>(e=>{o(e);let t=e.split("\n"),a=[];for(let e of t){let[t,n]=e.split(",");if(!t)continue;let l=parseInt(n||"1");!isNaN(l)&&l>0&&a.push({name:t.trim(),count:l})}n(a)})(e.target.value),placeholder:"格式：獎品名稱,數量，例如：\n100 元禮券,2\n電影票x2,1",className:"w-full border p-2 rounded font-mono"}):(0,a.jsxs)(a.Fragment,{children:[t.map((e,l)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"獎品名稱",value:t[l].name,onChange:e=>c(l,"name",e.target.value),className:"flex-auto border p-2 rounded w-1/2"}),(0,a.jsxs)("label",{className:"flex-auto",children:["剩餘 ",t[l].count-r.reduce((e,n)=>n.prize==t[l].name?e+1:e,0)," /"]}),(0,a.jsx)("input",{type:"number",min:1,value:t[l].count,onChange:e=>c(l,"count",e.target.value),className:"flex-auto border p-2 rounded w-20"}),(0,a.jsx)("button",{onClick:()=>(e=>{let a=[...t];a.splice(e,1),n(a)})(l),className:"flex-initial del-btn-bg hover:del-btn-bg text-white px-4 py-2 rounded",disabled:t.length<=1,children:"X"})]},l)),(0,a.jsx)("button",{onClick:()=>{n([...t,{name:"",count:1}])},className:"mt-2 text-blue-600 hover:underline",children:"+ 新增獎品"})]})]})}let i=crypto.getRandomValues.bind(crypto);function d(e,t){let n,a=t-e+1,l=new Uint32Array(1),r=0xffffffff-0x100000000%a;do i(l),n=l[0];while(n>r);return e+n%a}function o(e,t,n){let a=t.flatMap(e=>Array.from({length:e.count},()=>e.name));return({"no-repeat":(e,t)=>{let n=function(e){let t=[...e];for(let e=t.length-1;e>0;--e){let n=d(0,e);[t[e],t[n]]=[t[n],t[e]]}return t}(e);return t.map((e,t)=>({name:n[t],prize:e}))},"allow-repeat":(e,t)=>t.map(t=>({name:e[d(0,e.length-1)],prize:t}))})[n.repeat](e,a)}function c(e){let{candidates:t,prizes:n,drawRules:l,results:r,onDraw:s}=e;return(0,a.jsx)("button",{onClick:()=>{let e=new Set(r.map(e=>e.name)),a=t.filter(t=>!e.has(t)),i=n.map(e=>({name:e.name,count:e.count-r.reduce((t,n)=>n.prize==e.name?t+1:t,0)})),d=i.reduce((e,t)=>e+t.count,0);return"allow-repeat"===l.repeat&&t.length<=0?void alert("請至少輸入 1 位候選人"):"no-repeat"===l.repeat&&a.length<d?void alert("請至少再輸入 ".concat(d," 位候選人。")):0==d?void alert("獎品已全數抽出。"):void s([...o("no-repeat"===l.repeat?a:t,"first"===l.order?i.reverse():i,l),...r])},className:"btn-bg hover:btn-bg text-white px-4 py-2 rounded",children:"全部抽出"})}function u(e){let{candidates:t,prizes:n,drawRules:l,results:r,onDraw:s}=e;return(0,a.jsx)("button",{onClick:()=>{let e=new Set(r.map(e=>e.name)),a=t.filter(t=>!e.has(t)),i=n.flatMap(e=>{let t=e.count-r.reduce((t,n)=>n.prize==e.name?t+1:t,0);return t>0?{name:e.name,count:t}:void 0}).filter(e=>void 0!==e),d=i.reduce((e,t)=>e+t.count,0);return"allow-repeat"===l.repeat&&t.length<=0?void alert("請至少輸入 1 位候選人"):"no-repeat"===l.repeat&&a.length<1?void alert("請至少再輸入 1 位候選人。"):0==d?void alert("獎品已全數抽出。"):void s([...o("no-repeat"===l.repeat?a:t,[{name:"first"===l.order?i[0].name:i[i.length-1].name,count:1}],l),...r])},className:"btn-bg hover:btn-bg text-white px-4 py-2 rounded",children:"抽一次"})}var m=n(2338);function x(e){let{results:t,setResults:n}=e,r=(0,l.memo)(e=>{let{index:l,style:r,candidate:s,prize:i}=e;return(0,a.jsxs)("div",{style:r,className:"relative flex text-sm border-b border-gray-200 hover:bg-gray-50 ".concat(l%2==0?"bg-white":"bg-gray-50"),children:[(0,a.jsx)("span",{className:"w-4/9 px-4 py-2 truncate",children:s}),(0,a.jsx)("span",{className:"absolute opacity-0 select-text",children:","}),(0,a.jsx)("span",{className:"w-4/9 px-4 py-2 truncate",children:i}),(0,a.jsx)("span",{className:"absolute opacity-0 select-text",children:(0,a.jsx)("br",{})}),(0,a.jsx)("button",{onClick:()=>(e=>{let a=[...t];a.splice(e,1),n(a)})(l),className:"w-1/9 flex-initial del-btn-bg hover:del-btn-bg text-white px-2 py-2 rounded",disabled:t.length<=0,children:"X"})]})});return(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"w-1/3 text-xl font-medium",children:"得獎名單"}),(0,a.jsxs)("div",{className:"w-2/3 flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>{let e=[...t];e.splice(0,e.length),n(e)},className:"del-btn-bg hover:del-btn-bg text-white px-4 py-2 rounded",disabled:t.length<=0,children:"清除"}),(0,a.jsx)("button",{onClick:()=>{let e=new Blob([[...t.map(e=>"".concat(e.name,",").concat(e.prize))].join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download","draw_results.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)},className:"btn-bg hover:btn-bg text-white px-4 py-2 rounded transition",children:"下載 CSV"})]})]}),0===t.length?(0,a.jsx)("p",{className:"text-gray-500",children:"尚無得獎紀錄。"}):(0,a.jsxs)("div",{className:"rounded-lg shadow overflow-hidden border border-gray-300",children:[(0,a.jsxs)("div",{className:"flex bg-gray-100 text-left text-sm font-semibold border-b border-gray-300",children:[(0,a.jsx)("div",{className:"w-4/9 px-4 py-2",children:"得獎者"}),(0,a.jsx)("div",{className:"w-4/9 px-4 py-2",children:"獎品"}),(0,a.jsx)("div",{className:"w-1/9 px-4 py-2"})]}),(0,a.jsx)(m.Y1,{height:600,itemCount:t.length,itemSize:40,width:"100%",children:e=>{let{index:n,style:l}=e;return(0,a.jsx)(r,{index:n,style:l,candidate:t[n].name,prize:t[n].prize})}})]})]})}function p(){let[e,t]=(0,l.useState)([]),[n,i]=(0,l.useState)([{name:"",count:1}]),[d,o]=(0,l.useState)([]),[m,p]=(0,l.useState)({repeat:"no-repeat",order:"first"});return(0,a.jsxs)("div",{className:"h-[100%] flex flex-col md:flex-row gap-4 justify-center items-center md:items-start",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl min-h-200 max-w-xl w-full px-8 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-8 text-center",children:"簡易抽獎機"}),(0,a.jsxs)("div",{className:"flex justify-start mt-6 gap-2",children:[(0,a.jsx)(c,{candidates:e,prizes:n,drawRules:m,results:d,onDraw:o}),(0,a.jsx)(u,{candidates:e,prizes:n,drawRules:m,results:d,onDraw:o})]}),(0,a.jsxs)("div",{className:"mt-4 mb-4",children:[(0,a.jsx)("label",{className:"font-medium",children:"抽獎規則："}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-start gap-2 mt-2",children:[(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:m.repeat,onChange:e=>p({...m,repeat:e.target.value}),children:[(0,a.jsx)("option",{value:"no-repeat",children:"每人僅得獎一次"}),(0,a.jsx)("option",{value:"allow-repeat",children:"允許重複得獎"})]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:m.order,onChange:e=>p({...m,order:e.target.value}),children:[(0,a.jsx)("option",{value:"first",children:"從第一個獎品開始抽"}),(0,a.jsx)("option",{value:"last",children:"從最後一個獎品開始抽"})]})]})]}),(0,a.jsx)(r,{onChange:t}),(0,a.jsx)(s,{prizes:n,setPrizes:i,drawResult:d})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl min-h-200 max-w-xl w-full px-8 py-4",children:(0,a.jsx)(x,{results:d,setResults:o})})]})}},9896:(e,t,n)=>{Promise.resolve().then(n.bind(n,7099))}},e=>{e.O(0,[338,561,742,358],()=>e(e.s=9896)),_N_E=e.O()}]);